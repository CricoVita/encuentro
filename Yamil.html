<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel MET Bolivia ‚Äì NAABOL</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="favicon.png">

  <style>
    body { margin:0; font-family:Arial, sans-serif; transition:background 0.8s ease; }
    .dia { background:linear-gradient(to top,#87CEEB,#ffffff); color:#222; }
    .dia::before { content:""; position:fixed; inset:0; background:url('nubes.png') repeat-x; background-size:300px auto; animation:moverNubes 60s linear infinite; opacity:0.25; z-index:-1; }
    .noche { background:radial-gradient(circle at 50% 10%,#0b0c10,#000); color:#ddd; }
    .noche::before { content:""; position:fixed; inset:0; background:url('estrellas.png') repeat-x; background-size:300px auto; animation:moverEstrellas 90s linear infinite; opacity:0.38; z-index:-2; }
    .noche::after { content:""; position:fixed; top:24px; right:36px; width:160px; height:160px; background:url('luna.png') no-repeat; background-size:contain; opacity:0.8; z-index:-1; }

    @keyframes moverNubes { from{background-position:0 0;} to{background-position:100% 0;} }
    @keyframes moverEstrellas { from{background-position:0 0;} to{background-position:100% 0;} }

    h1 { text-align:center; font-size:1.2rem; margin:10px 0; }
    .panel { display:grid; grid-template-columns:repeat(auto-fit,minmax(320px,1fr)); gap:20px; padding:0 12px 12px; }
    .card { border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.12); padding:12px; color:#fff; }
    .card h3 { margin:0 0 8px; font-size:1.05em; display:flex; align-items:center; justify-content:flex-start; gap:8px; }
    .icao { font-weight:700; opacity:0.9; }
    pre { background:rgba(255,255,255,0.18); padding:8px; border-radius:6px; white-space:pre-wrap; color:#fff; font-size:0.9em; margin:6px 0; }
    .extras { font-size:0.82em; color:#ffebcd; margin-top:6px; }
    .hora,.contador { font-size:0.82em; margin-top:6px; }
    .icono { font-size:1.4em; margin-right:6px; }

    .tormenta{background:linear-gradient(135deg,#7a1010,#b22222);}
    .lluvia{background:linear-gradient(135deg,#1e3c72,#2a5298);}
    .niebla{background:linear-gradient(135deg,#5a5a5a,#888);}
    .nieve{background:linear-gradient(135deg,#4f6d8c,#8aa9c2);}
    .viento{background:linear-gradient(135deg,#4b2e83,#6b5ca5);}
    .normal{background:linear-gradient(135deg,#2e8b57,#3cb371);}

    .boton-copiar{display:block;margin:10px auto;padding:8px 15px;background:#2e8b57;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;}
    .boton-copiar:hover{background:#3cb371;}
    footer{text-align:center;margin-top:10px;font-size:0.82em;color:#aaa;padding:10px;}
  </style>
</head>
<body>
  <h1>Informaci√≥n Meteorol√≥gica Aeron√°utica ‚Äì Bolivia (NAABOL)</h1>
  <button class="boton-copiar" id="btnCopiar">üìã Copiar METAR</button>
  <div class="panel" id="panel"></div>
  <footer>¬© 2026 Cristian ‚Äî Panel con datos oficiales de NAABOL</footer>

  <script>
    function aplicarFondo(){
      const hora=new Date().getHours();
      document.body.className=(hora>=6&&hora<18)?"dia":"noche";
    }
    aplicarFondo(); setInterval(aplicarFondo,60000);

    const aeropuertos={"SLLP":"El Alto - La Paz","SLCB":"Cochabamba","SLTR":"Trinidad","SLVR":"Santa Cruz - Viru Viru","SLGM":"Guayaramer√≠n","SLRQ":"Rurrenabaque","SLRI":"Riberalta"};
    const INTERVALO_MS=600000; let proximaActualizacion=Date.now()+INTERVALO_MS;

    function obtenerIcono(metar){
      const has=s=>metar.includes(s);
      if(has("TS"))return{icono:"üå©Ô∏è",clase:"tormenta"};
      if(has("RA"))return{icono:"üåßÔ∏è",clase:"lluvia"};
      if(has("FG")||has("BR"))return{icono:"üå´Ô∏è",clase:"niebla"};
      if(has("SN"))return{icono:"‚ùÑÔ∏è",clase:"nieve"};
      if(has("WS"))return{icono:"üå™Ô∏è",clase:"viento"};
      if(has("CAVOK"))return{icono:"‚òÄÔ∏è",clase:"normal"};
      return{icono:"‚òÅÔ∏è",clase:"normal"};
    }

    function obtenerIconosExtras(metar){
      const extras=[]; const has=s=>metar.includes(s);
      if(has("TS"))extras.push("üå©Ô∏è Tormenta");
      if(has("RA"))extras.push("üåßÔ∏è Lluvia");
      if(has("FG")||has("BR"))extras.push("üå´Ô∏è Niebla");
      if(has("SN"))extras.push("‚ùÑÔ∏è Nieve");
      if(has("WS"))extras.push("üå™Ô∏è Viento fuerte");
      if(has("CAVOK"))extras.push("‚òÄÔ∏è Cielo despejado");
      return extras.length?extras.join(" ¬∑ "):"‚òÅÔ∏è Sin fen√≥menos significativos";
    }

    // Nueva funci√≥n: METAR + SPECI
    function extraeMetarYSPECI(texto,icao){
      const reMetar=new RegExp(String.raw`(?:^|\n)\s*-?\s*METAR\s+${icao}\b.*`,"i");
      const reSpe=new RegExp(String.raw`(?:^|\n)\s*-?\s*SPECI\s+${icao}\b.*`,"i");
      const mMetar=texto.match(reMetar);
      const mSpe=texto.match(reSpe);
      const limpiar=str=>str?str.replace(/[\x00-\x1F\x7F]/g," ").replace(/\s+/g," ").trim():null;
      const bloqueMetar=limpiar(mMetar?mMetar[0]:null);
      const bloqueSpe=limpiar(mSpe?mSpe[0]:null);
      if(bloqueMetar&&bloqueSpe)return bloqueMetar+"\n"+bloqueSpe;
      return bloqueMetar||bloqueSpe||"No disponible";
    }

    async function cargarMETAR(){
      const panel=document.getElementById("panel"); panel.innerHTML="";
      try{
        const origen='http://sare.naabol.gob.bo/ifis-appv3/public/sabo?page=1';
        const url='https://api.allorigins.win/raw?url='+encodeURIComponent(origen);
        const resp=await fetch(url,{cache:"no-store"});
        if(!resp.ok)throw new Error(`HTTP ${resp.status}`);
        const html=await resp.text();
        const parser=new DOMParser(); const doc=parser.parseFromString(html,"text/html");
        const textoPlano=(doc&&doc.body)?doc.body.textContent:html;

        for(const icao of Object.keys(aeropuertos)){
          let data=extraeMetarYSPECI(textoPlano,icao);
          const {icono,clase}=obtenerIcono(data);
          const extras=obtenerIconosExtras(data);
          const horaLocal=new Date().toLocaleTimeString();

          const card=document.createElement("div");
          card.className=`card ${clase}`;
          card.innerHTML=`
            <h3><span class="icono">${icono}</span>${aeropuertos[icao]} <span class="icao">(${icao})</span></h3>
            <pre>${data}</pre>
            <div class="extras">Fen√≥menos: ${extras}</div>
            <div class="hora">√öltima actualizaci√≥n: ${horaLocal}</div>
            <div class="contador" id="contador-${icao}"></div>
          `;
          panel.appendChild(card);
        }
      } catch (err) {
        const error = document.createElement("div");
        error.className = "card niebla";
        error.innerHTML = `
          <h3>‚ö†Ô∏è Error al obtener datos</h3>
          <pre>${(err && err.message) ? err.message : "Error desconocido"}</pre>
          <div class="extras">Intentaremos nuevamente en el pr√≥ximo ciclo.</div>
        `;
        panel.appendChild(error);
        console.error("Error al obtener datos de NAABOL:", err);
      }

      proximaActualizacion = Date.now() + INTERVALO_MS;
    }

    function actualizarContadores() {
      for (const icao of Object.keys(aeropuertos)) {
        const el = document.getElementById(`contador-${icao}`);
        if (!el) continue;
        const restante = Math.max(0, proximaActualizacion - Date.now());
        const minutos = Math.floor(restante / 60000);
        const segundos = Math.floor((restante % 60000) / 1000);
        el.textContent = `Pr√≥xima actualizaci√≥n en ${minutos}:${segundos.toString().padStart(2, "0")}`;
      }
    }

    function copiarMETAR() {
      const bloques = Array.from(document.querySelectorAll(".card pre"))
        .map(pre => pre.textContent.trim())
        .filter(t => t && t !== "No disponible");
      const texto = bloques.join("\n\n");
      if (!texto) {
        alert("No hay METAR/SPECI disponibles para copiar a√∫n.");
        return;
      }
      navigator.clipboard.writeText(texto)
        .then(() => alert("‚úÖ METAR/SPECI copiados al portapapeles"))
        .catch(err => console.error("Error al copiar:", err));
    }

    // Inicializaci√≥n
    cargarMETAR();
    setInterval(cargarMETAR, INTERVALO_MS);
    setInterval(actualizarContadores, 1000);
    document.getElementById("btnCopiar").addEventListener("click", copiarMETAR);
  </script>
</body>
</html>






























